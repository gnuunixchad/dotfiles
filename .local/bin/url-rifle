#!/usr/bin/sh
# @author nate zhou
# @since 2025
# Execuate different open actions based on URL patterns.
#
# Use case in `newsboat/config`:
# `browser "~/.local/bin/url-rifle %u"`
# If the link is an image, preview it, other wise open the link in a browser.

url="$1"

print_err() {
    local RED='\033[0;31m'
    local RESET='\033[0m'
    printf ${RED}"${1}"${RESET}\\n
}

[ -z "$1" ] && print_err "No URL specified." && exit 1


case "$url" in
    *jpeg|*jpg|*png|*gif|*webp|*svg)
        curl --silent --location "$url" | swayimg --class='Floating_IMG' - &
        ;;
    *epub|*pdf)
        curl --silent --location "$url" | zathura - &
        ;;
    *)
        if [ "$XDG_SESSION_TYPE" = "tty" ]; then
            w3m "$url"
        else
            qutebrowser --target window --set tabs.show never "$url"
        fi
        ;;
esac
