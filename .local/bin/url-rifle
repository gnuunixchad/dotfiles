#!/usr/bin/sh
# @author nate zhou
# @since 2025
# url - rifle Execuate different open actions based on URL patterns.
#
# [Usage]
# - newsboat:
#   `browser "~/.local/bin/url-rifle %u"`
#
# - qutebrowser:
#   `config.bind('xl', 'hint links userscript qute-rifle')`

url="$1"

print_err() {
    local RED='\033[0;31m'
    local RESET='\033[0m'
    printf ${RED}"${1}"${RESET}\\n
}

notify() {
    [ "$XDG_SESSION_TYPE" = "tty" ] return
    notify-send -u low -t 3300 "$(basename $0)" "Downloading ${filetype}:\n $url"
}

[ -z "$1" ] && print_err "No URL specified." && exit 1


case "$url" in
    *jpeg|*jpg|*png|*gif|*webp|*svg)
        filetype="image" notify
        curl --silent --location "$url" | swayimg --class='Floating_IMG' - &
        ;;
    *epub|*pdf)
        filetype="document" notify
        curl --silent --location "$url" | zathura - &
        ;;
    *)
        if [ "$XDG_SESSION_TYPE" = "tty" ]; then
            w3m "$url"
        else
            notify-send -u low -t 1100 "$(basename $0)" "Open in browser:\n $url"
            qutebrowser --target auto --set tabs.show never "$url" &
        fi
        ;;
esac
