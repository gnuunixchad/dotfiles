#!/usr/bin/sh
# @author nate zhou
# @since 2024,2025
# use wmenu to select the audio source for voice recording

RECORD_HOME="${HOME}/tmp/recordings"
[ -d "$RECORD_HOME" ] || mkdir -p $RECORD_HOME

filename="${RECORD_HOME}/$(date +%Y-%m-%d_%H_%M_%S).mp3"

notifyStart() {
    notify-send -u low -r 1258 "$(basename "$0")"  "on $source"
}

notifyStop() {
    notify-send -u low -r 1258 "$(basename "$0")" "stopped $source"
}

setSource() {
if [ "$XDG_SESSION_TYPE" != "tty" ]; then
    pactl list short sources | awk '{print $2}' | sort \
        | wmenu-color '-p[choose source] ' -l 6
else
    pactl list short sources | awk '{print $2}' | sort \
        | command fzf --prompt '[choose source] '
fi
}

source="$(setSource)"
[ -z "$source" ] && exit 0

notifyStart

trap notifyStop EXIT INT TERM

pw-record --target "$source" "$filename"
