#!/usr/bin/sh
# @author nate zhou
# @since 2024,2025
# shoot - Take a screenshot with selected region in wlroots compositors.
# @depends wmenu grim wlr-rander

[ -z "$GRIM_DEFAULT_DIR" ] && GRIM_DEFAULT_DIR="$HOME/tmp/screenshots"
SCREENSHOT_HOME="${HOME}/tmp/screenshots"
[ -d "$SCREENSHOT_HOME" ] || mkdir -p $SCREENSHOT_HOME

filename="${SCREENSHOT_HOME}/$(date +%Y-%m-%d_%H_%M_%S).png"

notify() {
    notify-send -u low "$(basename $0)" "$region"
}

shootOutput() {
    region="$(wlr-randr \
                            | grep '^[a-zA-Z0-9]'\
                            | wmenu-color -p "$(basename $0)" -l 3 \
                            | tr -d '()' \
                            | cut -d' ' -f-1 )"
    sleep 0.1
    grim -o "$region" "$filename"
    notify
}

shootAll() {
    region="all outputs"
    grim "$filename"
    notify
}

shootGeo() {
    region=$(slurp)
    grim -g "$region" "$filename"
    notify
}

[ -z "$1" ] && shootOutput

case "$1" in
    -a|--all) shootAll ;;
    -g|--geo) shootGeo ;;
esac
