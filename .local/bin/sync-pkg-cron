#!/usr/bin/sh
# @ author nate zhou
# @ since 2024,2025,2026
# sync-pkg-cron
# @depends ${HOME}/.local/bin/sync-pkg

LOG="${HOME}/.cache/sync-pkg-cron.log"

# modified time in seconds since the Epoch
update_time=$(stat -c "%Y" "$LOG")
# seconds since the Epoch
current_time=$(date +%s)
UPDATE_FREQUENCY=604800 # in seconds, 7d

sync_pkg() {
    ${HOME}/.local/bin/sync-pkg && echo "$(date): synced" > $LOG
}

if [ ! -f "$LOG" ]; then
    sync_pkg
    exit 0
fi

# check last update time
if [ $((current_time - update_time)) -gt $UPDATE_FREQUENCY ]; then
    sync_pkg
else
    echo "Already updated within past $((UPDATE_FREQUENCY/3600/24)) days"
    exit 1
fi
