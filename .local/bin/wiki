#!/usr/bin/sh
# @author nate zhou
# @since 2024,2025,2026
# search arch-wiki-docs package's files in wmenu and open in browser

WIKI_PATH_SHARE="/usr/share/doc/arch-wiki/html/en/"
WIKI_PATH_LOCAL="$HOME/doc/arch-wiki/"

menu=""

if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
    menu="${HOME}/.local/bin/wmenu-color"
elif [ -n "$XAUTHORITY" ]; then
    menu="dmenu"
fi

if [ -d "$WIKI_PATH_SHARE" ]; then
    WIKI_PATH="$WIKI_PATH_SHARE"
else
    WIKI_PATH="$WIKI_PATH_LOCAL"
fi

if [ -n "$menu" ]; then
    selected_page="$(find "$WIKI_PATH" -type f \
        | $menu -l 6 -i -p "$(basename "$0")")"
    # don't do anything if exiting wmenu without any input
    [ -n "$selected_page" ] && $BROWSER file://"$selected_page"
else
    selected_page="$(find "$WIKI_PATH" -type f \
    | fzf --preview 'scope {}' \
          --bind=ctrl-j:preview-down,ctrl-k:preview-up \
          --reverse)"
    # don't do anything if exiting wmenu without any input
    [ -n "$selected_page" ] && w3m file://"$selected_page"
fi

