#!/usr/bin/sh
# @author nate zhou
# @since 2024,2025
# decrypt the gpg encrypted image file and pipe to a viewer without writing to
# the disk

usage() {
    cat << _EOF_
USAGE
        $(basename "$0") FILE
_EOF_
}

[ "$#" -eq 0 ] && (usage; exit 0)

gpg_passphrase=$(echo "" | wmenu-color -P -p "[$(basename $0)] passphrase: ")

[ -z "$gpg_passphrase" ] && exit 1

case "$1" in
    *.pdf.gpg)
        echo "$gpg_passphrase" \
            | gpg --no-symkey-cache --batch --passphrase-fd 0 -d "$1" \
            | zathura -
        ;;
    *.gif.gpg)
        echo "$gpg_passphrase" \
            | gpg --no-symkey-cache --batch --passphrase-fd 0 -d "$1" \
            | swayimg -
        ;;
    *)
        echo "$gpg_passphrase" \
            | gpg --no-symkey-cache --batch --passphrase-fd 0 -d "$1" \
            | mpv - --loop --no-resume-playback
        ;;
esac
