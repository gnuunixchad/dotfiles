#!/usr/bin/sh
# @author nate zhou
# @since 2026
# blue - interactively toggle bluetooth devices
# @depends wmenu, fzf, bluez-utils

#set -x

prompt="[$(basename $0)]"
menu=""

notify() {
    [ "$XDG_SESSION_TYPE" != "tty" ] \
        && notify-send -r 700 "$(basename $0)" "$1" 2>/dev/null
}

select_device() {
    if [ "$XDG_SESSION_TYPE" = "tty" ]; then
        menu="fzf --prompt"
    else
        menu="${HOME}/.local/bin/wmenu-color -l5 -p"
    fi

    bluetoothctl devices | cut -d' ' -f2- | $menu "$prompt" | cut -d' ' -f1
}

is_connected() {
    [ -z "$1" ] && exit 0
    bluetoothctl info "$1" | grep -q "Connected: yes" && return 0 || return 1
}

toggle_connection() {
    is_connected "$1" \
        && bluetoothctl disconnect "$1" \
        || bluetoothctl connect "$1"
}

toggle_connection "$(select_device)"
