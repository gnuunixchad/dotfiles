#!/usr/bin/sh
# @author nate zhou
# @since 2025
# wmenu/fzf script for selecting pipewire default sink (choose speaker)

DAMBLOCKS="${XDG_RUNTIME_DIR}/damblocks.pid"

notify() {
    [ "$XDG_SESSION_TYPE" != "tty" ] \
        && notify-send -u low -r 1259 "$(basename "$0")" "$sink"
}

setSink() {
    if [ "$XDG_SESSION_TYPE" != "tty" ]; then
        pactl list short sinks | awk '{print $2}' \
                               | wmenu-color '-p[speaker] ' -l 3
    else
        pactl list short sinks | awk '{print $2}' \
                               | command fzf --prompt '[speaker] '
    fi
}

refreshVolume() {
    kill -36 "$(cat "$DAMBLOCKS")"
}


sink="$(setSink)"
[ -z "$sink" ] && exit 0


pactl set-default-sink "$sink" && refreshVolume && notify
